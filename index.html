<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ummeats | TAMU EXPRESS Orders & Feedback</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="icon" type="image/png" href="https://i.ibb.co/KcFc8xn5/Gemini-Generated-Image-jokiqjjokiqjjoki.png">
</head>
<body class="bg-gray-100">

<!-- MARQUEE -->
<marquee behavior="scroll" direction="left" scrollamount="6" class="bg-red-600 text-white font-semibold py-3 px-4 rounded shadow mx-4 mt-2">
âš ï¸ IMPORTANT NOTICE: Orders above KSh 400 attract a service fee of KSh 60. No morning orders are accepted. Lunch orders are accepted from 11:30 AM â€“ 2:00 PM. Evening orders are accepted from 4:00 PM â€“ 8:00 PM. Kindly be advised that if ordered food is not available, you're requested to browse and look for other replacements or contact customer care (0115613332). All confirmed orders will be delivered. Ramadhan is almost here! Vouchers for both morning and evening orders are now available at only KES 1,500. For more info, contact 0115613332 / 0116860686.
</marquee>

<!-- HEADER / TOP MENU -->
<header class="bg-green-700 text-white p-6 flex flex-col md:flex-row md:items-center md:justify-between space-y-3 md:space-y-0 md:space-x-4">
  <div>
    <h1 class="text-3xl font-bold mb-1"> Ummeats</h1>
    <p class="text-green-100 text-sm">Local Kibanda / Shop Orders + Feedback</p>
  </div>
  <div class="flex flex-col md:flex-row md:space-x-4 space-y-2 md:space-y-0">
    <button id="feedbackBtn" class="bg-white text-green-700 py-2 px-4 rounded font-bold w-full md:w-auto">
      ğŸ’¬ Feedback
    </button>
    <button id="backBtn" class="bg-white text-green-700 py-2 px-4 rounded font-bold w-full md:w-auto">
      ğŸ”™ Back to Ummeats
    </button>
  </div>
</header>

<!-- MAIN CONTENT -->
<main class="p-6 space-y-10 max-w-4xl mx-auto">

  <!-- ORDER FORM -->
  <section id="orderSection" class="bg-white p-6 rounded-xl shadow-lg">
    <h2 class="text-2xl font-bold mb-4">ğŸ›’ Place Your Order</h2>

    <input id="customerName" class="w-full border p-2 rounded mb-3" placeholder="Your Name">
    <input id="customerEmail" class="w-full border p-2 rounded mb-3" placeholder="Your Email">
    <input id="shopName" class="w-full border p-2 rounded mb-3" placeholder="ğŸ´ Shop Here â†’">

    <div class="flex gap-2 mb-3">
      <input id="itemName" class="w-2/3 border p-2 rounded" placeholder="Item name">
      <input id="itemQty" class="w-1/3 border p-2 rounded" placeholder="Qty">
    </div>

    <button id="addItemBtn" class="w-full bg-green-600 text-white py-2 rounded font-bold mb-4">â• Add Item</button>

    <ul id="itemsList" class="list-disc pl-6 mb-4 text-gray-700"></ul>

    <input id="totalAmount" class="w-full border p-2 rounded mb-3" placeholder="Estimated / Real Amount (KES)">
    <input id="mpesaCode" class="w-full border p-2 rounded mb-3" placeholder="Mpesa Transaction Code">

    <button id="submitOrderBtn" class="w-full bg-green-700 text-white py-2 rounded font-bold">Submit Full Order </button>
    <p id="orderStatus" class="mt-3 font-semibold"></p>
  </section>

  <!-- CUSTOMER ORDERS PANEL -->
  <section id="customerSection" class="bg-white p-6 rounded-xl shadow-lg">
    <h2 class="text-xl font-bold mb-3"> Your Orders</h2>
    <div id="customerOrders" class="space-y-3"></div>
  </section>

  <!-- FEEDBACK SECTION -->
  <section id="feedbackSection" class="hidden bg-white p-6 rounded-xl shadow-lg">
    <h2 class="text-2xl font-bold mb-4"> Feedback</h2>

    <input id="fbName" class="w-full border p-2 rounded mb-3" placeholder="Your Name">
    <input id="fbEmail" class="w-full border p-2 rounded mb-3" placeholder="Your Email">
    <textarea id="fbMessage" class="w-full border p-2 rounded mb-3" placeholder="Write your feedback here..." rows="4"></textarea>
    <button id="submitFeedbackBtn" class="w-full bg-blue-600 text-white py-2 rounded font-bold">Submit Feedback</button>
    <p id="fbStatus" class="mt-3 font-semibold"></p>
  </section>

  <!-- ADMIN PANEL -->
  <section id="adminPanel" class="hidden bg-black text-white p-6 rounded-xl">
    <h2 class="text-xl font-bold mb-4">ğŸ”’ Admin Panel</h2>
    <div id="adminOrders" class="space-y-3"></div>
    <div id="adminFeedbacks" class="space-y-3 mt-6"></div>
  </section>

</main>

<footer id="footerTrigger" class="text-center bg-gray-300 py-3 cursor-pointer mt-6">
  Â© 2026 Ummeats â€” Click 4 times for Admin
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyApi2RjwEXEW2mTwCMiYERKUNAYL8Toddk",
  authDomain: "tamuexpress-26e4a.firebaseapp.com",
  projectId: "tamuexpress-26e4a",
  storageBucket: "tamuexpress-26e4a.appspot.com",
  messagingSenderId: "202068792631",
  appId: "1:202068792631:web:8a9b97028ebd7a45af76b2"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const ordersCollection = collection(db,"orders");
const feedbackCollection = collection(db,"feedbacks");

const feedbackBtn = document.getElementById("feedbackBtn");
const backBtn = document.getElementById("backBtn");
const feedbackSection = document.getElementById("feedbackSection");
const orderSection = document.getElementById("orderSection");
const customerSection = document.getElementById("customerSection");
const submitFeedbackBtn = document.getElementById("submitFeedbackBtn");
const fbStatus = document.getElementById("fbStatus");

const itemNameInput = document.getElementById("itemName");
const itemQtyInput = document.getElementById("itemQty");
const itemsList = document.getElementById("itemsList");
const addItemBtn = document.getElementById("addItemBtn");
const submitOrderBtn = document.getElementById("submitOrderBtn");
const orderStatus = document.getElementById("orderStatus");
const customerOrdersDiv = document.getElementById("customerOrders");

let orderItems = [];

// Wait for DOM
document.addEventListener("DOMContentLoaded", () => {

  // Feedback toggle
  feedbackBtn.addEventListener("click", ()=>{
    feedbackSection.classList.toggle("hidden");
    orderSection.classList.add("hidden");
    customerSection.classList.add("hidden");
  });

  // Back Button
  backBtn.addEventListener("click", ()=>{
    window.location.href = "https://purinekaka70-svg.github.io/Ummeats/";
  });

  // Submit Feedback
  submitFeedbackBtn.addEventListener("click", async()=>{
    const name = document.getElementById("fbName").value.trim();
    const email = document.getElementById("fbEmail").value.trim();
    const message = document.getElementById("fbMessage").value.trim();

    if(!name||!email||!message){ alert("Fill all fields"); return; }

    try{
      await addDoc(feedbackCollection,{name,email,message,time:new Date()});
      fbStatus.textContent=" Feedback submitted!";
      fbStatus.className="text-green-600 font-bold";
      document.getElementById("fbName").value="";
      document.getElementById("fbEmail").value="";
      document.getElementById("fbMessage").value="";
    }catch(err){ console.log(err); fbStatus.textContent=" Error"; fbStatus.className="text-red-600 font-bold"; }
  });

  // ADD ITEM
  addItemBtn.addEventListener("click", () => {
    const name = itemNameInput.value.trim();
    const qty = itemQtyInput.value.trim();
    if (!name || !qty) { alert("Enter item name and qty"); return; }
    orderItems.push({name, qty});
    renderItems();
    itemNameInput.value=""; itemQtyInput.value="";
  });

  function renderItems() {
    itemsList.innerHTML="";
    orderItems.forEach((item,index)=>{
      const li=document.createElement("li");
      li.textContent=`${item.qty} x ${item.name}`;
      const removeBtn=document.createElement("button");
      removeBtn.textContent="";
      removeBtn.className="ml-2 text-red-600";
      removeBtn.addEventListener("click",()=>{ orderItems.splice(index,1); renderItems(); });
      li.appendChild(removeBtn);
      itemsList.appendChild(li);
    });
  }

  // SUBMIT ORDER
  submitOrderBtn.addEventListener("click", async()=>{
    const customerName=document.getElementById("customerName").value.trim();
    const customerEmail=document.getElementById("customerEmail").value.trim();
    const shopName=document.getElementById("shopName").value.trim();
    const totalAmount=document.getElementById("totalAmount").value.trim();
    const mpesaCode=document.getElementById("mpesaCode").value.trim();

    if(!customerName||!customerEmail||!shopName||orderItems.length===0||!totalAmount||!mpesaCode){
      alert("Fill all fields & add at least one item"); return;
    }

    try {
      await addDoc(ordersCollection,{
        customerName, customerEmail, shopName, items: orderItems, totalAmount, mpesaCode, time:new Date()
      });
      orderStatus.textContent="Order submitted!";
      orderStatus.className="text-green-600 font-bold";
      document.getElementById("customerName").value="";
      document.getElementById("customerEmail").value="";
      document.getElementById("shopName").value="";
      document.getElementById("totalAmount").value="";
      document.getElementById("mpesaCode").value="";
      orderItems=[];
      renderItems();
      displayCustomerOrders();
    } catch(err){ console.log(err); orderStatus.textContent="Error"; orderStatus.className="text-red-600 font-bold"; }
  });

  // DISPLAY CUSTOMER ORDERS
  async function displayCustomerOrders(){
    customerOrdersDiv.innerHTML="";
    const snapshot=await getDocs(ordersCollection);
    snapshot.forEach(doc=>{
      const data=doc.data();
      const div=document.createElement("div");
      div.className="p-3 border rounded bg-gray-50";
      const itemsText=data.items.map(i=>`${i.qty} x ${i.name}`).join(", ");
      div.innerHTML=`
        <p><strong>Name:</strong> ${data.customerName}</p>
        <p><strong>Email:</strong> ${data.customerEmail}</p>
        <p><strong>Shop:</strong> ${data.shopName}</p>
        <p><strong>Items:</strong> ${itemsText}</p>
        <p><strong>Total:</strong> KES ${data.totalAmount}</p>
        <p><strong>Mpesa:</strong> ${data.mpesaCode}</p>
        <hr class="my-2">
      `;
      customerOrdersDiv.appendChild(div);
    });
  }

  // Load orders on page load
  displayCustomerOrders();

});
</script>

</body>
</html>
